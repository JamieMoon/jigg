package jigg.pipeline

import java.util.Properties
import org.scalatest.FunSuite
import org.scalatest.Matchers._

class DocumentKNPAnnotatorTest extends FunSuite {
  def newKNP(p: Properties = new Properties) = try Some(new DocumentKNPAnnotator("knp", p))
  catch { case e: Throwable => None }

  test("getCoreferences 1"){
    val docNode = <document id="d0"><sentences><sentence id="s0">太郎が走る。<tokens><token features="&quot;人名:日本:名:45:0.00106 疑似代表表記 代表表記:太郎/たろう&quot; &lt;人名:日本:名:45:0.00106&gt;&lt;疑似代表表記&gt;&lt;代表表記:太郎/たろう&gt;&lt;正規化代表表記:太郎/たろう&gt;&lt;文頭&gt;&lt;漢字&gt;&lt;かな漢字&gt;&lt;名詞相当語&gt;&lt;自立&gt;&lt;内容語&gt;&lt;タグ単位始&gt;&lt;文節始&gt;&lt;固有キー&gt;&lt;文節主辞&gt;&lt;係:ガ格&gt;&lt;NE:PERSON:S&gt;" inflectionFormId="0" inflectionTypeId="0" pos1Id="5" posId="6" reading="たろう" base="太郎" inflectionForm="*" inflectionType="*" pos1="人名" pos="名詞" surf="太郎" id="s0_tok0"/><token features="NIL &lt;かな漢字&gt;&lt;ひらがな&gt;&lt;付属&gt;" inflectionFormId="0" inflectionTypeId="0" pos1Id="1" posId="9" reading="が" base="が" inflectionForm="*" inflectionType="*" pos1="格助詞" pos="助詞" surf="が" id="s0_tok1"/><token features="&quot;代表表記:走る/はしる&quot; &lt;代表表記:走る/はしる&gt;&lt;正規化代表表記:走る/はしる&gt;&lt;表現文末&gt;&lt;かな漢字&gt;&lt;活用語&gt;&lt;自立&gt;&lt;内容語&gt;&lt;タグ単位始&gt;&lt;文節始&gt;&lt;文節主辞&gt;" inflectionFormId="2" inflectionTypeId="10" pos1Id="0" posId="2" reading="はしる" base="走る" inflectionForm="基本形" inflectionType="子音動詞ラ行" pos1="*" pos="動詞" surf="走る" id="s0_tok2"/><token features="NIL &lt;文末&gt;&lt;英記号&gt;&lt;記号&gt;&lt;付属&gt;" inflectionFormId="0" inflectionTypeId="0" pos1Id="1" posId="1" reading="。" base="。" inflectionForm="*" inflectionType="*" pos1="句点" pos="特殊" surf="。" id="s0_tok3"/></tokens><basicPhrases><basicPhrase features="&lt;文頭&gt;&lt;人名&gt;&lt;ガ&gt;&lt;助詞&gt;&lt;体言&gt;&lt;係:ガ格&gt;&lt;区切:0-0&gt;&lt;格要素&gt;&lt;連用要素&gt;&lt;名詞項候補&gt;&lt;先行詞候補&gt;&lt;SM-人&gt;&lt;SM-主体&gt;&lt;正規化代表表記:太郎/たろう&gt;&lt;NE:PERSON:太郎&gt;&lt;照応詞候補:太郎&gt;&lt;解析格:ガ&gt;&lt;EID:0&gt;" tokens="s0_tok0 s0_tok1" id="s0_bp0"/><basicPhrase features="&lt;文末&gt;&lt;句点&gt;&lt;用言:動&gt;&lt;レベル:C&gt;&lt;区切:5-5&gt;&lt;ID:（文末）&gt;&lt;係:文末&gt;&lt;提題受:30&gt;&lt;主節&gt;&lt;格要素&gt;&lt;連用要素&gt;&lt;動態述語&gt;&lt;正規化代表表記:走る/はしる&gt;&lt;用言代表表記:走る/はしる&gt;&lt;時制-未来&gt;&lt;主題格:一人称優位&gt;&lt;格関係0:ガ:太郎&gt;&lt;格解析結果:走る/はしる:動13:ガ/C/太郎/0/0/d0-s0;ヲ/U/-/-/-/-;ニ/U/-/-/-/-;ト/U/-/-/-/-;デ/U/-/-/-/-;カラ/U/-/-/-/-;ヨリ/U/-/-/-/-;マデ/U/-/-/-/-;時間/U/-/-/-/-;外の関係/U/-/-/-/-;ノ/U/-/-/-/-;修飾/U/-/-/-/-;トスル/U/-/-/-/-;ニオク/U/-/-/-/-;ニカンスル/U/-/-/-/-;ニヨル/U/-/-/-/-;ヲフクメル/U/-/-/-/-;ヲハジメル/U/-/-/-/-;ヲノゾク/U/-/-/-/-;ヲツウジル/U/-/-/-/-&gt;&lt;EID:1&gt;&lt;述語項構造:走る/はしる:動13:ガ/C/太郎/0&gt;" tokens="s0_tok2 s0_tok3" id="s0_bp1"></basicPhrase></basicPhrases></sentence><sentence id="s1">太郎が歩く。<tokens><token features="&quot;人名:日本:名:45:0.00106 疑似代表表記 代表表記:太郎/たろう&quot; &lt;人名:日本:名:45:0.00106&gt;&lt;疑似代表表記&gt;&lt;代表表記:太郎/たろう&gt;&lt;正規化代表表記:太郎/たろう&gt;&lt;文頭&gt;&lt;漢字&gt;&lt;かな漢字&gt;&lt;名詞相当語&gt;&lt;自立&gt;&lt;内容語&gt;&lt;タグ単位始&gt;&lt;文節始&gt;&lt;固有キー&gt;&lt;文節主辞&gt;&lt;係:ガ格&gt;&lt;NE:PERSON:S&gt;" inflectionFormId="0" inflectionTypeId="0" pos1Id="5" posId="6" reading="たろう" base="太郎" inflectionForm="*" inflectionType="*" pos1="人名" pos="名詞" surf="太郎" id="s1_tok0"/><token features="NIL &lt;かな漢字&gt;&lt;ひらがな&gt;&lt;付属&gt;" inflectionFormId="0" inflectionTypeId="0" pos1Id="1" posId="9" reading="が" base="が" inflectionForm="*" inflectionType="*" pos1="格助詞" pos="助詞" surf="が" id="s1_tok1"/><token features="&quot;代表表記:歩く/あるく&quot; &lt;代表表記:歩く/あるく&gt;&lt;正規化代表表記:歩く/あるく&gt;&lt;表現文末&gt;&lt;かな漢字&gt;&lt;活用語&gt;&lt;自立&gt;&lt;内容語&gt;&lt;タグ単位始&gt;&lt;文節始&gt;&lt;文節主辞&gt;" inflectionFormId="2" inflectionTypeId="2" pos1Id="0" posId="2" reading="あるく" base="歩く" inflectionForm="基本形" inflectionType="子音動詞カ行" pos1="*" pos="動詞" surf="歩く" id="s1_tok2"/><token features="NIL &lt;文末&gt;&lt;英記号&gt;&lt;記号&gt;&lt;付属&gt;" inflectionFormId="0" inflectionTypeId="0" pos1Id="1" posId="1" reading="。" base="。" inflectionForm="*" inflectionType="*" pos1="句点" pos="特殊" surf="。" id="s1_tok3"/></tokens><basicPhrases><basicPhrase features="&lt;文頭&gt;&lt;人名&gt;&lt;ガ&gt;&lt;助詞&gt;&lt;体言&gt;&lt;係:ガ格&gt;&lt;区切:0-0&gt;&lt;格要素&gt;&lt;連用要素&gt;&lt;名詞項候補&gt;&lt;先行詞候補&gt;&lt;SM-人&gt;&lt;SM-主体&gt;&lt;正規化代表表記:太郎/たろう&gt;&lt;NE:PERSON:太郎&gt;&lt;照応詞候補:太郎&gt;&lt;解析格:ガ&gt;&lt;C用;【太郎】;=;1;0;9.99:d0-s0(1文前):0文節&gt;&lt;共参照&gt;&lt;COREFER_ID:1&gt;&lt;REFERRED:1-0&gt;&lt;EID:0&gt;" tokens="s1_tok0 s1_tok1" id="s1_bp0"/><basicPhrase features="&lt;文末&gt;&lt;句点&gt;&lt;用言:動&gt;&lt;レベル:C&gt;&lt;区切:5-5&gt;&lt;ID:（文末）&gt;&lt;係:文末&gt;&lt;提題受:30&gt;&lt;主節&gt;&lt;格要素&gt;&lt;連用要素&gt;&lt;動態述語&gt;&lt;正規化代表表記:歩く/あるく&gt;&lt;用言代表表記:歩く/あるく&gt;&lt;時制-未来&gt;&lt;主題格:一人称優位&gt;&lt;格関係0:ガ:太郎&gt;&lt;格解析結果:歩く/あるく:動12:ガ/C/太郎/0/0/d0-s1;ヲ/U/-/-/-/-;ニ/U/-/-/-/-;ト/U/-/-/-/-;デ/U/-/-/-/-;カラ/U/-/-/-/-;ヨリ/U/-/-/-/-;ヘ/U/-/-/-/-;時間/U/-/-/-/-;外の関係/U/-/-/-/-;修飾/U/-/-/-/-;ノ/U/-/-/-/-;トスル/U/-/-/-/-;ニツク/U/-/-/-/-;ニムケル/U/-/-/-/-;ニソウ/U/-/-/-/-;トイウ/U/-/-/-/-&gt;&lt;EID:2&gt;&lt;述語項構造:歩く/あるく:動12:ガ/C/太郎/0&gt;" tokens="s1_tok2 s1_tok3" id="s1_bp1"></basicPhrase></basicPhrases></sentence></sentences></document>

    val expected = <coreferences><coreference id="d0_coref0" basicPhrases="s0_bp0 s1_bp0" /><coreference id="d0_coref1" basicPhrases="s0_bp1" /><coreference id="d0_coref2" basicPhrases="s1_bp1" /></coreferences>

    newKNP() foreach { knp =>
      knp.getCoreferences(docNode) should be (expected)
    }
  }
}
